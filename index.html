<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Essence | Official Site</title>
  <meta name="description" content="The Essence â€” cinematic rock/metal by Tim Pelzer. Listen, watch, press assets, and merch." />

  <!-- Preloads -->
  <link rel="preload" as="image" href="hero.jpg?v=4" />
  <link rel="preload" as="image" href="site-bg-poster.jpg?v=5" />
  <link rel="preload" as="video" href="site-bg.mp4?v=5" type="video/mp4" />

  <style>
    :root{
      --bg:#0b0c10;
      --panel:#121317;
      --ink:#e9edf1;
      --muted:#a6b0ba;
      --accent:#ff6a00;
      --accent2:#4cb1ff;
      --card:#151822;
      --border:#232632;
      --shadow:0 10px 30px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    html,body{margin:0;height:100%;scroll-behavior:smooth}

    body{
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);   /* solid fallback */
      color:var(--ink);
    }

    /* =========================================================
       FIXED BACKGROUND STACK (poster + two forward videos)
       - Shows poster first
       - Crossfades from Video A to Video B near the end
       - Then from B back to A, forever (smooth loop)
       ========================================================= */
    .bg-stack{
      position:fixed;
      inset:0;
      z-index:0;           /* above body background, below page content */
      overflow:hidden;
      background:#0b0c10;  /* behind poster/video just in case */
      pointer-events:none; /* let clicks pass to content */
    }
    .bg-poster,
    .bg-video{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .bg-poster{
      opacity:1;
      transition:opacity 600ms ease;
      background:#0b0c10;
    }
    .bg-video{
      opacity:0;
      transition:opacity 700ms ease; /* crossfade duration */
    }
    /* When any video is playing, fade the poster out */
    .bg-stack.is-playing .bg-poster{ opacity:0; }

    /* Show the active track (A or B) */
    .bg-stack.show-a .bg-video--a{ opacity:1; }
    .bg-stack.show-b .bg-video--b{ opacity:1; }

    /* Page content wrapper sits above the background */
    .page{ position:relative; z-index:1; }

    img{max-width:100%;height:auto;display:block}
    a{color:var(--accent2);text-decoration:none}
    a:hover{opacity:.9}
    h1,h2{letter-spacing:.2px}

    /* ===========================
       Layout + header / nav
       =========================== */
    .wrap{max-width:1120px;margin:0 auto;padding:16px 24px}

    header{
      position:sticky; top:0; z-index:50;
      background:rgba(11,12,16,.85);
      backdrop-filter:saturate(140%) blur(8px);
      border-bottom:1px solid var(--border);
    }

    .nav{display:flex;align-items:center;gap:16px}

    /* Bigger wordmark in header (fallback <img>) */
    .brand img{
      height:clamp(60px, 8vw, 96px);
      width:auto;
      filter:drop-shadow(0 2px 0 rgba(0,0,0,.5));
    }

    /* Metallic version using CSS mask (preferred) */
    .brand .wordmark-metal{
      display:none; /* hidden until masks supported */
      height:clamp(60px, 8vw, 96px);
      aspect-ratio: 5 / 1; /* adjust if looks off; keeps natural wide shape */
      /* metallic gradient fill */
      background:
        linear-gradient(90deg,
          #8e9298 0%,
          #e5e8ec 20%,
          #7b7f86 40%,
          #f4f6f8 60%,
          #8e9298 80%,
          #d5d9de 100%);
      filter:drop-shadow(0 2px 0 rgba(0,0,0,.5));
      /* use your PNG as a mask to punch the letters out of the gradient */
      -webkit-mask-image: url('logo-wordmark.png');
              mask-image: url('logo-wordmark.png');
      -webkit-mask-repeat: no-repeat;
              mask-repeat: no-repeat;
      -webkit-mask-size: contain;
              mask-size: contain;
      -webkit-mask-position: left center;
              mask-position: left center;
    }

    /* Prefer the metallic masked version when supported */
    @supports ((-webkit-mask-image: url("")) or (mask-image: url(""))){
      .brand img{ display:none; }
      .brand .wordmark-metal{ display:block; }
    }

    .spacer{flex:1}

    .nav-links{display:flex;gap:14px;align-items:center}
    .nav-links a{padding:8px 10px;border-radius:10px}
    .nav-links a:hover{background:rgba(255,255,255,.05)}

    /* Mobile hamburger */
    .burger{
      display:none; cursor:pointer; width:42px; height:42px;
      border:1px solid var(--border); border-radius:10px;
      align-items:center; justify-content:center;
      background:transparent; color:var(--ink);
    }
    .burger span, .burger span::before, .burger span::after{
      display:block; width:18px; height:2px; background:var(--ink); position:relative; content:"";
    }
    .burger span::before{position:absolute; top:-6px}
    .burger span::after{position:absolute; top:6px}

    @media (max-width: 820px){
      .nav{
        flex-wrap: wrap; /* ensures the menu wraps below logo/burger instead of going off-screen */
      }
      .nav-links{display:none; width:100%; flex-direction:column; align-items:flex-start; padding-top:12px}
      .nav.open .nav-links{display:flex}
      .burger{display:flex}
    }

    /* ===========================
       Hero (layout only; image layer omitted)
       =========================== */
    .hero{
      position:relative; min-height:56vh; display:grid; place-items:center; text-align:center;
      border-bottom:1px solid var(--border); overflow:hidden;
    }
    .hero-bg{position:absolute; inset:0; overflow:hidden}
    .hero-bg::after{
      content:""; position:absolute; inset:0;
      background:url('hero.jpg?v=4') center center/contain no-repeat;
      filter:blur(2px) contrast(1.03);
      opacity:0.85;
    }
    .hero-inner{position:relative; z-index:1; padding:40px}

    /* ===========================
      Common UI
      =========================== */
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}

    .cta{
      display:inline-block; padding:12px 18px; border-radius:999px;
      background:var(--accent); color:#0e0f14; font-weight:700; box-shadow:var(--shadow)
    }
    /* Outline variant for the Entropy button */
    .cta--outline{
      background:transparent;
      color:var(--accent);
      border:2px solid var(--accent);
      box-shadow:none;
    }
    .cta--outline:hover{
      background:rgba(255,106,0,0.08);
    }

    .btn{
      display:inline-block; padding:10px 14px; border-radius:12px; border:1px solid var(--border)
    }

    section{padding:56px 0; border-bottom:1px solid var(--border)}
    h2{font-size:clamp(1.4rem,3vw,2rem); margin:0 0 12px}
    p.lead{color:var(--muted); margin:0 0 22px}

    .cards{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:18px}
    .card{background:var(--card); border:1px solid var(--border); border-radius:18px; overflow:hidden; box-shadow:var(--shadow)}
    .card .pad{padding:14px}

    .media-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:18px}

    .store-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:16px}
    .price{color:var(--ink); font-weight:700}

    .press-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:16px}
    .press-item{background:var(--card); border:1px solid var(--border); border-radius:16px; overflow:hidden}

    footer{background:var(--panel); padding:28px 20px; color:var(--muted); text-align:center}
    .tags{display:flex; flex-wrap:wrap; gap:10px}
    .tag{font-size:.85rem; padding:6px 10px; border:1px solid var(--border); border-radius:999px; color:var(--muted)}
  </style>
</head>

<body>
  <!-- Fixed background stack: poster + two forward videos for smooth crossfade loop -->
  <div class="bg-stack" id="bgStack" aria-hidden="true">
    <img class="bg-poster" id="bgPoster" src="site-bg-poster.jpg?v=5" alt="">
    <!-- Video A -->
    <video
      class="bg-video bg-video--a"
      id="bgVidA"
      playsinline
      muted
      preload="auto"
      poster="site-bg-poster.jpg?v=5"
    >
      <source src="site-bg.webm?v=5" type="video/webm" />
      <source src="site-bg.mp4?v=5"  type="video/mp4"  />
    </video>
    <!-- Video B (same content as A) -->
    <video
      class="bg-video bg-video--b"
      id="bgVidB"
      playsinline
      muted
      preload="auto"
      poster="site-bg-poster.jpg?v=5"
    >
      <source src="site-bg.webm?v=5" type="video/webm" />
      <source src="site-bg.mp4?v=5"  type="video/mp4"  />
    </video>
  </div>

  <!-- Page content above the background -->
  <div class="page">
    <!-- Header (sticky) -->
    <header>
      <div class="wrap nav" id="nav">
        <a class="brand" href="#home" aria-label="Home">
          <!-- Metallic wordmark using mask + gradient -->
          <span class="wordmark-metal" role="img" aria-label="The Essence"></span>
          <!-- Fallback image (shown if mask unsupported) -->
          <img src="logo-wordmark.png" alt="The Essence" />
        </a>
        <div class="spacer"></div>
        <button class="burger" id="burger" aria-label="Open navigation"><span></span></button>
        <nav class="nav-links" id="nav-links" aria-label="Primary">
          <a href="#music">Music</a>
          <a href="#video">Video</a>
          <a href="#store">Store</a>
          <a href="#about">About</a>
          <a href="#press">Press</a>
          <a href="#contact">Contact</a>
        </nav>
      </div>
    </header>

    <!-- Hero -->
    <section class="hero" id="home" aria-label="Hero">
      <!-- hero-bg DIV intentionally removed -->
      <div class="hero-inner">
        <div class="row" style="justify-content:center;gap:18px;margin:18px 0 8px">
          <a class="cta cta--outline" href="https://artists.landr.com/990591880986" target="_blank" rel="noopener">Entropy â€” Listen Now</a>
          <a class="btn" href="https://artists.landr.com/055905269007" target="_blank" rel="noopener">Caverns â€” All Platforms</a>
          <a class="btn" href="https://www.youtube.com/@theessence7391" target="_blank" rel="noopener">YouTube</a>
        </div>
        <div class="row" style="justify-content:center;gap:16px;margin-top:14px">
          <img src="entropy-cover.png" alt="Entropy cover" style="height:150px;border-radius:10px;border:1px solid var(--border)">
          <img src="caverns-cover.png" alt="Caverns cover" style="height:150px;border-radius:10px;border:1px solid var(--border)">
        </div>
      </div>
    </section>

    <!-- Music -->
    <section id="music">
      <div class="wrap">
        <h2>Music</h2>
        <p class="lead">Featured releases. Stream everywhere via the promo link.</p>
        <div class="cards">
          <article class="card">
            <img src="entropy-cover.png" alt="Entropy â€” single cover" />
            <div class="pad">
              <h3 style="margin:0 0 6px">Entropy</h3>
              <p class="lead">Single Â· 2025</p>
              <div class="row">
                <a class="btn" href="https://artists.landr.com/990591880986" target="_blank" rel="noopener">All Platforms</a>
                <a class="btn" href="https://www.youtube.com/@theessence7391" target="_blank" rel="noopener">YouTube</a>
              </div>
            </div>
          </article>
          <article class="card">
            <img src="caverns-cover.png" alt="Caverns â€” album cover" />
            <div class="pad">
              <h3 style="margin:0 0 6px">Caverns</h3>
              <p class="lead">Album Â· 2025</p>
              <div class="row">
                <a class="btn" href="https://artists.landr.com/055905269007" target="_blank" rel="noopener">All Platforms</a>
                <a class="btn" href="https://www.youtube.com/@theessence7391" target="_blank" rel="noopener">YouTube</a>
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>

    <!-- Featured Video -->
    <section id="video">
      <div class="wrap">
        <h2>Featured Video</h2>
        <div class="media-grid">
          <iframe
            src="https://www.youtube.com/embed/B8R860OmTOk"
            title="The Essence - Featured Video"
            allowfullscreen
            loading="lazy"
            style="width:100%;min-height:380px;border:0;border-radius:12px"
          ></iframe>

          <iframe
            src="https://www.youtube.com/embed/P6t9UBbMxSQ"
            title="The Essence - Featured Video 2"
            allowfullscreen
            loading="lazy"
            style="width:100%;min-height:380px;border:0;border-radius:12px"
          ></iframe>
        </div>
      </div>
    </section>

    <!-- Store -->
    <section id="store">
      <div class="wrap">
        <h2>Store</h2>
        <p class="lead">Connect a Printful storefront when youâ€™re ready. Replace <code>PRINTFUL_STORE_URL</code> below.</p>
        <div class="store-grid">
          <article class="card">
            <img src="logo-mark.jpg" alt="Logo mark tee" />
            <div class="pad">
              <h3 style="margin:0 0 6px">Logo Mark Tee</h3>
              <p class="price">$28</p>
              <a class="btn" href="PRINTFUL_STORE_URL" target="_blank" rel="noopener">Buy</a>
            </div>
          </article>
          <article class="card">
            <img src="entropy-cover.png" alt="Entropy artwork tee" />
            <div class="pad">
              <h3 style="margin:0 0 6px">Entropy Tee</h3>
              <p class="price">$28</p>
              <a class="btn" href="PRINTFUL_STORE_URL" target="_blank" rel="noopener">Buy</a>
            </div>
          </article>
          <article class="card">
            <img src="caverns-cover.png" alt="Caverns artwork tee" />
            <div class="pad">
              <h3 style="margin:0 0 6px">Caverns Tee</h3>
              <p class="price">$28</p>
              <a class="btn" href="PRINTFUL_STORE_URL" target="_blank" rel="noopener">Buy</a>
            </div>
          </article>
        </div>
        <div class="row" style="margin-top:16px">
          <a class="cta" href="PRINTFUL_STORE_URL" target="_blank" rel="noopener">Shop All</a>
        </div>
      </div>
    </section>

    <!-- About -->
    <section id="about">
      <div class="wrap">
        <h2>About The Essence</h2>
        <div class="media-grid">
          <div>
            <p class="lead">About The Essence<br><br>
Tim Pelzer is a multi instrumentalist who resides just outside of Calgary Alberta, Canada. The Essence is a passion project he started in 2019 out of a desire to see the production of more quality, Christian music that challenges and edifies the listener. "ClichÃ© or compromise" have long been the predominant options within Christian art, and Tim wants to be a part of the recent tide of change that seems to be occurring.<br><br>
There is a prevailing narrative in the Christian Music Industry that in order for Christian music to find success, the "Christian" element must be watered down, or follow the same cookie cutter templates that have already been tried. This may be true... if the sole pursuit is success in the eyes of the large record labels. But what would happen if more Christian artists sought to create music with the primary purpose of honoring Christ, a secondary purpose of achieving quality and exceptionalism, and a tertiary purpose of finding success? Would we find that uncompromising biblical messaging actually resonates with more people than we think? Is there a "void" in the music industry waiting to be filled?<br><br>
A combination of a love for the Word of God, some challenging life experiences, and a taste for hard hitting, cinematic rock/metal are what have shaped the sound of The Essence. Sonic influences include legendary powerhouses such as Red, Skillet, Chevelle, Muse, Starset, Disciple, Love and Death, Silent Planet, and of course, Hans Zimmer. "Caverns" Is The Essence's debut album, comprised of songs Tim has written over the past 6 years which stem from his intense pursuit of purpose.<br><br>
While the present overall production value may be limited (as with most independent artists starting out),  Tim has a vision for where this music could someday go as he grows in his knowledge and resources within the realm of music production. There is no room for filler tracks in The Essence's discography. If a track makes it into the public space, it's because it has been poured over with intentionality and refined with scrutiny. Whether it's a hit, or a flop, you can be confident no track will ever lack effort. All this to create hard hitting rock with a hard hitting message.</p>
          </div>
          <div>
            <img src="press1.jpg" alt="Tim Pelzer portrait" style="border-radius:14px;border:1px solid var(--border)">
          </div>
        </div>
      </div>
    </section>

    <!-- Press -->
    <section id="press">
      <div class="wrap">
        <h2>Press</h2>
        <p class="lead">Click the collage to download the full press kit (ZIP). Add photos as <code>press-01.jpg</code>, <code>press-02.jpg</code>, â€¦; the collage and ZIP update automatically. Logos are included after photos.</p>

        <!-- Collage preview (auto-generated) that downloads the ZIP -->
        <a class="press-item" id="collageLink" href="#" download>
          <img id="pressCollage" src="" alt="Press kit collage â€” click to download ZIP" style="border-radius:16px;border:1px solid var(--border)">
        </a>

        <div class="card" style="margin-top:10px">
          <div class="pad">
            <h3 style="margin:0 0 6px">Short Bio</h3>
            <p class="lead" style="max-width:70ch">The Essence is the cinematic rock/metal project of multi-instrumentalist <strong>Tim Pelzer</strong> from the Calgary area. Launched in 2019, The Essence pairs hard-hitting sonics with unapologetically Christian themes, aiming for excellence without compromise. Debut album <em>Caverns</em> and new single <em>Entropy</em> showcase his vision for high-impact, faith-forward rock.</p>
            <div class="tags" style="margin-top:8px">
              <span class="tag">Genre: Cinematic Rock / Metal</span>
              <span class="tag">Location: Calgary, AB</span>
              <span class="tag">For press: tim.theessence@gmail.com</span>
            </div>
            <p style="margin-top:12px">
              <a class="btn" id="downloadZipBtn" href="#" download>Download Press Kit (ZIP)</a>
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Newsletter (HubSpot) â€” just above Contact -->
    <section id="newsletter">
      <div class="wrap">
        <h2>Newsletter</h2>
        <p class="lead">Sign up to get new music, videos, and updates from The Essence.</p>
        <div class="card">
          <div class="pad">
            <!-- HubSpot embed (exactly as provided) -->
            <script src="https://js-na3.hsforms.net/forms/embed/342376968.js" defer></script>
            <div class="hs-form-frame" data-region="na3" data-form-id="d80b2576-093f-498d-8065-db5f9530882e" data-portal-id="342376968"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Contact -->
    <section id="contact">
      <div class="wrap">
        <h2>Contact</h2>
        <p class="lead">Bookings, licensing, collaborations, or press.</p>
        <div class="row">
          <a class="btn" href="mailto:tim.theessence@gmail.com">tim.theessence@gmail.com</a>
          <a class="btn" href="https://www.youtube.com/@theessence7391" target="_blank" rel="noopener">YouTube</a>
          <a class="btn" href="https://www.instagram.com/the_essence_band/" target="_blank" rel="noopener">Instagram</a>
          <a class="btn" href="https://www.facebook.com/TTheEssence/" target="_blank" rel="noopener">Facebook</a>
          <a class="btn" href="https://artists.landr.com/990591880986" target="_blank" rel="noopener">Entropy â€” All Links</a>
        </div>
      </div>
    </section>

    <footer>
      <div class="wrap">
        <div class="row">
          <span>Â© 2025 The Essence</span>
          <span style="margin-left:auto">Built for GitHub Pages</span>
        </div>
      </div>
    </footer>
  </div> <!-- /.page -->

  <!-- JSZip for in-browser ZIP creation -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <script>
    // ===========================
    // Seamless loop controller: crossfade Video A -> Video B -> A -> ...
    // (with slower playback)
    // ===========================
    const stack = document.getElementById('bgStack');
    const posterEl = document.getElementById('bgPoster');
    const vidA = document.getElementById('bgVidA');
    const vidB = document.getElementById('bgVidB');

    const PLAYBACK_RATE = 0.75;  // slower playback
    vidA.playbackRate = PLAYBACK_RATE;
    vidB.playbackRate = PLAYBACK_RATE;

    let active = vidA;
    let standby = vidB;
    let crossfading = false;
    let fadeWindow = 0.8; // seconds before end to start crossfade (will be recalculated after metadata)
    const FADE_MS = 700;

    function setShow(which){
      if (which === vidA){
        stack.classList.add('show-a');
        stack.classList.remove('show-b');
      } else {
        stack.classList.add('show-b');
        stack.classList.remove('show-a');
      }
      stack.classList.add('is-playing'); // hide poster when anything plays
    }

    function prepareStandby(){
      try { standby.currentTime = 0; } catch(e){}
    }

    function onTimeUpdate(){
      if (crossfading) return;
      const dur = active.duration || 0;
      if (!isFinite(dur) || dur === 0) return;

      const windowSec = fadeWindow || 0.8;
      if (active.currentTime >= dur - windowSec){
        crossfading = true;

        // Start the standby video from the beginning and show it
        prepareStandby();
        standby.play().catch(()=>{});
        setShow(standby);

        // After fade, stop & reset the previous active, then swap
        setTimeout(() => {
          try { active.pause(); } catch(e){}
          try { active.currentTime = 0; } catch(e){}
          // swap roles
          const tmp = active;
          active = standby;
          standby = tmp;
          crossfading = false;
        }, FADE_MS + 60);
      }
    }

    function recalcFadeWindow(video){
      const d = video.duration || 0;
      if (!isFinite(d) || d === 0) return;
      // crossfade ~10% of duration, clamped between 0.5s and 1.5s
      fadeWindow = Math.min(1.5, Math.max(0.5, d * 0.10));
    }

    function startPlayback(){
      // Recompute fade window based on actual duration
      recalcFadeWindow(active);
      setShow(active);
      active.play().catch(()=>{});
    }

    // Attach listeners
    vidA.addEventListener('timeupdate', onTimeUpdate);
    vidB.addEventListener('timeupdate', onTimeUpdate);

    vidA.addEventListener('loadedmetadata', () => { if (active === vidA) recalcFadeWindow(vidA); });
    vidB.addEventListener('loadedmetadata', () => { if (active === vidB) recalcFadeWindow(vidB); });

    // Kick off when A can play
    vidA.addEventListener('canplay', startPlayback, { once:true });

    // Nudge autoplay in some browsers
    const tryKick = () => { active.play().catch(()=>{}); };
    document.addEventListener('visibilitychange', tryKick, { once:true });
    window.addEventListener('pointerdown', tryKick, { once:true });

    // ===========================
    // Mobile hamburger toggle + close on link click
    // ===========================
    const nav = document.getElementById('nav');
    const burger = document.getElementById('burger');
    const links = document.getElementById('nav-links');

    const toggleNav = () => nav.classList.toggle('open');
    burger.addEventListener('click', toggleNav);
    links.querySelectorAll('a').forEach(a =>
      a.addEventListener('click', () => nav.classList.remove('open'))
    );

    // ===========================
    // Smooth-scroll offset for sticky header
    // ===========================
    const headerHeight = () => document.querySelector('header').getBoundingClientRect().height || 0;
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', (e) => {
        const id = anchor.getAttribute('href');
        if (id.length > 1 && document.querySelector(id)) {
          e.preventDefault();
          const target = document.querySelector(id);
          const y = target.getBoundingClientRect().top + window.pageYOffset - (headerHeight() + 8);
          window.scrollTo({ top: y, behavior: 'smooth' });
        }
      });
    });

    // ===========================
    // PRESS: discover assets (root + /assets/), draw collage, build ZIP
    // ===========================
    const PRESS = { paths: { photos: [], logos: [] }, images: { photos: [], logos: [] } };

    function listCandidates() {
      const DIRS = ['', 'assets/'];
      const EXTS = ['.jpg','.jpeg','.png','.webp'];

      const photoBases = [
        ...Array.from({length:24}, (_,i)=>`press-${String(i+1).padStart(2,'0')}`),
        'press1','press2','press3','press4','press5','press6'
      ];

      const normalLogoNames = [
        'logo-wordmark.png',
        'logo-wordmark-black.jpg',
        'logo-wordmark-white-on-black-wide.jpg',
        'logo-mark.jpg',
        'logo-mark.png',
        'logo-mark-alt.jpg',
        'logo-mark-inverse.png',
        'logo-mark-with-wordmark.jpg',
        'logo-mark-with-wordmark.png',
        'logo-mark-with-wordmark-inverse.png',
        'logo-mark-with-wordmark-inverse-on-black.jpg',
        'logo-wordmark-alt.png'
      ];

      /* legacy double-extension variants (in case any linger) */
      const oddLogoNames = [
        'logo-wordmark-alt.png.png',
        'logo_wordmark_black.jpg.jpg',
        'logo-wordmark-white-on-black-wide.jpg.jpg',
        'logo-mark-with-wordmark.jpg.jpg',
        'logo-with-wordmark.png.png',
        'logo-mark-alt.jpg.jpg',
        'logo-mark.png.png',
        'logo-mark-with-wordmark-inverse.png.png',
        'logo-mark-with-wordmark-inverse-on-black.jpg.jpg',
        'logo-mark-inverse.png.png'
      ];

      const photoCandidates = [];
      for (const base of photoBases){
        for (const dir of DIRS){
          for (const ext of EXTS){
            photoCandidates.push(dir + base + ext);
          }
        }
      }

      const logoCandidates = [];
      for (const name of [...normalLogoNames, ...oddLogoNames]){
        for (const dir of DIRS){
          logoCandidates.push(dir + name);
        }
      }

      return { photoCandidates, logoCandidates };
    }

    (function buildPressCollage(){
      const canvas = document.createElement('canvas');
      const W = canvas.width = 1200;
      const H = canvas.height = 675;
      const ctx = canvas.getContext('2d');
      const BUST = String(Math.floor(Date.now()/3600000)); // hourly cache bust

      const { photoCandidates, logoCandidates } = listCandidates();

      function load(path){
        return new Promise((resolve) => {
          const img = new Image();
          img.onload  = () => resolve({ ok:true, path, img });
          img.onerror = () => resolve({ ok:false, path });
          img.src = path + `?v=${BUST}`;
        });
      }

      const seen = new Set();
      Promise.all([
        ...photoCandidates.map(load),
        ...logoCandidates.map(load)
      ]).then(results => {
        const photos = [];
        const logos  = [];
        const photoPaths = [];
        const logoPaths  = [];

        for (const r of results){
          if (!r.ok) continue;
          if (seen.has(r.path)) continue;
          seen.add(r.path);
          if (/press-(\d+)|press\d+/i.test(r.path)){
            photos.push(r.img); photoPaths.push(r.path);
          } else {
            logos.push(r.img); logoPaths.push(r.path);
          }
        }

        PRESS.paths.photos = photoPaths;
        PRESS.paths.logos  = logoPaths;
        PRESS.images.photos = photos;
        PRESS.images.logos  = logos;

        // Draw collage
        const selected = [...photos, ...logos].slice(0, 9);
        ctx.fillStyle = '#0b0c10';
        ctx.fillRect(0,0,W,H);

        if (selected.length === 0){
          ctx.fillStyle = '#a6b0ba';
          ctx.font = '28px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
          ctx.fillText('No press images found in root or /assets/. Add press-01.jpg, press-02.jpg, â€¦', 36, H/2);
          document.getElementById('pressCollage').src = canvas.toDataURL('image/jpeg', 0.9);
          return;
        }

        const cols = Math.min(3, Math.ceil(Math.sqrt(selected.length)));
        const rows = Math.min(3, Math.ceil(selected.length / cols));
        const pad  = 18;
        const cellW = Math.floor((W - pad*(cols+1)) / cols);
        const cellH = Math.floor((H - pad*(rows+1)) / rows);

        function drawRounded(img, x, y, w, h, radius){
          const arImg = img.width / img.height;
          const arCell = w / h;
          let sx=0, sy=0, sw=img.width, sh=img.height;

          if (arImg > arCell) {
            sh = img.height;
            sw = sh * arCell;
            sx = (img.width - sw) / 2;
          } else {
            sw = img.width;
            sh = sw / arCell;
            sy = (img.height - sh) / 2;
          }

          const r = Math.min(radius, w/2, h/2);
          const ctx2 = ctx;
          ctx2.save();
          ctx2.beginPath();
          ctx2.moveTo(x+r, y);
          ctx2.arcTo(x+w, y, x+w, y+h, r);
          ctx2.arcTo(x+w, y+h, x, y+h, r);
          ctx2.arcTo(x, y+h, x, y, r);
          ctx2.arcTo(x, y, x+w, y, r);
          ctx2.closePath();
          ctx2.clip();
          ctx2.drawImage(img, sx, sy, sw, sh, x, y, w, h);
          ctx2.restore();
        }

        selected.forEach((img, i) => {
          const c = i % cols;
          const r = Math.floor(i / cols);
          const x = pad + c*(cellW+pad);
          const y = pad + r*(cellH+pad);
          drawRounded(img, x, y, cellW, cellH, 16);
        });

        ctx.strokeStyle = 'rgba(255,255,255,0.08)';
        ctx.lineWidth = 6;
        ctx.strokeRect(3,3,W-6,H-6);

        document.getElementById('pressCollage').src = canvas.toDataURL('image/jpeg', 0.9);
      });
    })();

    // ===========================
    // Generate ZIP on click using JSZip (always up to date)
    // ===========================
    async function generatePressKitZip(){
      const btn = document.getElementById('downloadZipBtn');
      const BUST = String(Math.floor(Date.now()/3600000));
      const setBusy = (busy) => {
        if (busy){
          btn && (btn.textContent = 'Preparingâ€¦');
          btn && (btn.style.opacity = '0.75');
        } else {
          btn && (btn.textContent = 'Download Press Kit (ZIP)');
          btn && (btn.style.opacity = '1');
        }
      };

      try{
        setBusy(true);
        const zip = new JSZip();
        const added = new Set();

        const allPaths = [...(PRESS.paths.photos||[]), ...(PRESS.paths.logos||[])];

        if (allPaths.length === 0){
          const { photoCandidates, logoCandidates } = listCandidates();
          allPaths.push(...photoCandidates, ...logoCandidates);
        }

        for (const path of allPaths){
          try{
            const res = await fetch(path + `?v=${BUST}`, { cache: 'no-store' });
            if (!res.ok) continue;
            const blob = await res.blob();

            const clean = path.replace(/^assets\//,'');
            const dot = clean.lastIndexOf('.');
            const base = dot>0 ? clean.slice(0,dot) : clean;
            const ext  = dot>0 ? clean.slice(dot) : '';

            let name = clean;
            let n = 2;
            while(added.has(name)){
              name = `${base}-${n}${ext}`;
              n++;
            }
            added.add(name);
            zip.file(name, blob);
          }catch(_e){}
        }

        if (added.size === 0){
          alert('No press assets found to package. Add files like press-01.jpg in the site root or /assets/.');
          return;
        }

        const blobZip = await zip.generateAsync({ type: 'blob' });
        const url = URL.createObjectURL(blobZip);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'press-kit.zip';
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
          URL.revokeObjectURL(url);
          a.remove();
        }, 4000);
      } finally {
        setBusy(false);
      }
    }

    document.getElementById('downloadZipBtn')?.addEventListener('click', (e) => {
      e.preventDefault();
      generatePressKitZip();
    });
    document.getElementById('collageLink')?.addEventListener('click', (e) => {
      e.preventDefault();
      generatePressKitZip();
    });
  </script>
</body>
</html>
